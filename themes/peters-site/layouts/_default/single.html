{{ define "main" }}
<div class="container">
  <aside class="table-of-contents"></aside>
  <div class="main wrapper-text">
  <h1>{{ .Title }}</h1>
  {{ $dateMachine := .Date | time.Format "2006-01-02T15:04:05-07:00" }}
  {{ $dateHuman := .Date | time.Format ":date_long" }}
  <time datetime="{{ $dateMachine }}">{{ $dateHuman }}</time>

  {{ .Content }}
  {{ partial "terms.html" (dict "taxonomy" "tags" "page" .) }}
  </div>
  <nav class="table-of-contents">
    <h1>Table of Contents</h1>
    <ol>
      {{ if gt (len .Fragments.Headings) 1 }}
      {{ warnf "%s has %d h1 headings which may break the table of contents" .Page.Title (len .Fragments.Headings) }}
      {{ end }}
      {{ if gt (len .Fragments.Headings) 0 }}
      {{ $toc_headings := (index .Fragments.Headings 0).Headings }}
      {{ range $toc_headings }}
      <li><span>></span><a href="#{{ .ID }}">{{ .Title }}</a></li>
      {{ end }}
      {{ end }}
    </ol>
  </nav>
  <script>
  document.addEventListener("scroll", function() {
    const sections = document.querySelectorAll("h2[id]");
    let currentSection = null;
  
    sections.forEach(section => {
      const sectionTop = section.getBoundingClientRect().top;
      if (sectionTop <= window.innerHeight / 2) {
        currentSection = section;
      }
    });
  
    if (currentSection) {
      const tocItems = document.querySelectorAll(".table-of-contents li");
      tocItems.forEach(item => {
        span = item.querySelector("span");
        span.classList.remove("active");
        if (item.querySelector("a").getAttribute("href") === `#${currentSection.id}`) {
          span.classList.add("active");
        }
      });
    }
  });
  </script>
</div>
{{ end }}